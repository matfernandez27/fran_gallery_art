<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Francisco Fernández | Galería de Arte Patagónico, Dibujo y Grabado Contemporáneo</title>
    
    <meta name="description" content="Galería oficial de Francisco Fernández. Descubre obras de arte patagónico, grabados, dibujos y pintura que exploran la dualidad entre lo ancestral y lo moderno.">

    <meta property="og:title" content="Francisco Fernández - Arte Patagónico y Grabado Contemporáneo">
    <meta property="og:description" content="Descubre la Galería Personal de Francisco Fernández: un diálogo visual entre la inmensidad de la Patagonia y la experiencia urbana moderna.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://fran-faf.vercel.app/">
    <meta property="og:image" content="[URL_IMAGEN_DESTACADA]"> 
    <meta property="og:locale" content="es_AR">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configuración de colores personalizados (VIVO Y CLARO)
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pantone-magenta': '#DE3B89', // PANTONE 17-2036 TPG/TCX
                        'bg-principal': '#FAEBF0', // Rosa muy claro / Blanco roto
                        'bg-card': '#FFFFFF',
                        'text-dark': '#333333',
                        'text-muted': '#666666',
                        'border-light': '#E0E0E0',
                        'whatsapp': '#25D366',
                    },
                    fontFamily: {
                        // Fuente moderna y legible
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* SPINNER DE CARGA */
        .loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(250, 235, 240, 0.95);
            display: flex; justify-content: center; align-items: center; z-index: 1000;
        }
        .lds-ring { display: inline-block; position: relative; width: 80px; height: 80px; }
        .lds-ring div { 
            box-sizing: border-box; display: block; position: absolute; width: 64px; height: 64px; margin: 8px; 
            border: 8px solid #DE3B89; 
            border-radius: 50%; animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite; 
            border-color: #DE3B89 transparent transparent transparent; 
        }
        .lds-ring div:nth-child(1) { animation-delay: -0.45s; }
        .lds-ring div:nth-child(2) { animation-delay: -0.3s; }
        .lds-ring div:nth-child(3) { animation-delay: -0.15s; }
        @keyframes lds-ring {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* WHATSAPP BUTTON */
        #whatsapp-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        #whatsapp-button.show {
            opacity: 1;
            visibility: visible;
        }

        /* CARRUSEL DE FONDO (Para la primer vista) */
        #carousel-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
            overflow: hidden;
        }
        .carousel-item {
            position: absolute;
            width: 100%; height: 100%;
            opacity: 0;
            transition: opacity 2s ease-in-out;
            background-size: cover;
            background-position: center;
            /* Efecto sutil para dar ambiente */
            filter: brightness(0.7) blur(1.5px); 
        }
        .carousel-item.active {
            opacity: 1;
        }

        /* MODAL */
        .modal {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 60;
        }
        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* FOOTER FLOTANTE */
        #main-footer {
            transition: transform 0.5s ease-out;
            z-index: 50;
        }

    </style>
    
</head>
<body class="bg-bg-principal text-text-dark font-sans">

    <div id="loading-overlay" class="loading-overlay">
        <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
    </div>
    
    <a id="whatsapp-button" href="https://wa.me/[TU_NUMERO_WHATSAPP_AQUI]?text=Hola%2C%20estoy%20interesado%20en%20una%20obra%20de%20tu%20galer%C3%ADa." target="_blank"
       class="bg-whatsapp hover:bg-green-600 text-white p-4 rounded-full shadow-lg transition duration-300 transform hover:scale-110">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.477 2 2 6.477 2 12c0 1.948.552 3.76 1.503 5.318L2.015 22l4.985-1.503A9.957 9.957 0 0012 22c5.523 0 10-4.477 10-10S17.523 2 12 2zm3.336 13.978a.8.8 0 01-1.129 0l-.84-.84a.4.4 0 00-.566 0l-1.35 1.35a.4.4 0 01-.566 0l-.744-.744a.4.4 0 010-.566l.54-.54a.8.8 0 010-1.13l-1.63-1.63a.8.8 0 010-1.13l1.63-1.63a.8.8 0 011.13 0l.54.54a.4.4 0 00.566 0l1.35-1.35a.4.4 0 000-.566l-.84-.84a.8.8 0 010-1.13l.84-.84a.8.8 0 011.13 0l1.63 1.63a.8.8 0 010 1.13l-1.63 1.63a.8.8 0 010 1.13l1.63 1.63a.8.8 0 010 1.13z"/>
        </svg>
    </a>


    <section class="relative min-h-screen flex items-center justify-center text-white overflow-hidden" 
             style="height: 100vh;">
        
        <div id="carousel-bg">
            <div class="carousel-item active" style="background-image: url('./img/bg_1.jpg');"></div>
            <div class="carousel-item" style="background-image: url('./img/bg_2.jpg');"></div>
            <div class="carousel-item" style="background-image: url('./img/bg_3.jpg');"></div>
        </div>

        <div class="relative z-10 text-center p-8 bg-black bg-opacity-40 rounded-lg shadow-2xl">
            <h1 class="text-6xl md:text-8xl font-light tracking-tight mb-4">Francisco Fernández</h1>
            <p class="text-xl md:text-2xl font-light text-pantone-magenta uppercase tracking-widest">Arte Patagónico Contemporáneo</p>
            <a href="#gallery-section" class="inline-block mt-10 text-sm uppercase tracking-widest font-semibold border-2 border-pantone-magenta text-white py-3 px-8 
                                            hover:bg-pantone-magenta transition duration-300">
                Ver Galería de Obras
            </a>
        </div>
    </section>

    <section id="bio-section" class="py-20 bg-bg-card">
        <div class="max-w-6xl mx-auto px-6">
            <div class="grid md:grid-cols-2 gap-16 items-center">
                <div>
                    <div class="w-16 h-px bg-pantone-magenta mb-8"></div>
                    
                    <h3 class="text-2xl font-medium text-text-dark mb-6">Francisco Fernández</h3>
                    
                    <p class="text-lg text-text-dark leading-relaxed mb-6">
                        Nacido en Trelew, Chubut hace 33 años y residente en la Patagonia, Francisco Fernández se destaca por su activa participación en exhibiciones itinerantes a lo largo del país.
                    </p>
                    
                    <p class="text-base text-text-muted leading-relaxed mb-6">
                        Su obra explora con maestría la intersección entre lo ancestral y lo contemporáneo, tejiendo un diálogo visual potente entre la inmensidad de la Patagonia y la vibrante experiencia urbana moderna.
                    </p>

                    <a href="./biografia-completa.html" 
                            class="text-sm uppercase tracking-wider font-semibold text-pantone-magenta hover:text-text-dark transition-colors duration-300 mt-4 inline-block">
                        Leer Biografía Completa →
                    </a>

                </div>
                <div class="flex justify-center">
                    <div class="w-80 h-80 rounded-sm overflow-hidden border-2 border-border-light shadow-xl">
                        <img src="./img/img_perfil.jpg" 
                            alt="Retrato de Francisco Fernández, artista plástico de la Patagonia."
                            class="w-full h-full object-cover"/>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="gallery-section" class="py-20 bg-bg-principal">
        <div class="max-w-7xl mx-auto px-6">
            
            <h2 class="text-4xl md:text-5xl font-light text-text-dark mb-8 text-center">
                Galería
            </h2>
            <div class="w-16 h-px bg-pantone-magenta mx-auto mb-12"></div>

            <div class="flex flex-wrap gap-4 mb-10 justify-between items-center bg-bg-card p-4 rounded-sm shadow-sm border border-border-light">
                
                <input id="search-input" type="text" placeholder="Buscar por título, técnica o descripción..." 
                       class="flex-grow p-3 border border-border-light rounded-sm focus:ring-pantone-magenta focus:border-pantone-magenta transition duration-200 min-w-[200px] md:min-w-[300px]" />
                
                <div class="flex flex-wrap gap-4">
                    <select id="filter-year" class="p-3 border border-border-light rounded-sm focus:ring-pantone-magenta focus:border-pantone-magenta">
                        <option value="">Año</option>
                        </select>
                    <select id="filter-category" class="p-3 border border-border-light rounded-sm focus:ring-pantone-magenta focus:border-pantone-magenta">
                        <option value="">Categoría</option>
                        </select>
                    <select id="filter-series" class="p-3 border border-border-light rounded-sm focus:ring-pantone-magenta focus:border-pantone-magenta">
                        <option value="">Serie</option>
                        </select>
                </div>
            </div>

            <div id="gallery-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                </div>

            <div id="load-more-container" class="text-center mt-12 hidden">
                <button id="load-more-button" class="bg-pantone-magenta hover:bg-opacity-80 text-white font-bold py-3 px-8 rounded-sm transition duration-300 text-sm uppercase tracking-wider shadow-md">
                    Cargar Más Obras
                </button>
            </div>
            
        </div>
    </section>

    <div id="obra-modal" class="modal fixed inset-0 hidden items-center justify-center p-4">
        <div class="modal-content bg-bg-card rounded-lg shadow-2xl max-w-5xl w-full flex flex-col md:flex-row relative">
            
            <button onclick="closeModal()" class="absolute top-3 right-3 text-white md:text-text-dark bg-black md:bg-transparent rounded-full p-2 transition hover:text-pantone-magenta z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <div class="w-full md:w-3/5 relative bg-black md:bg-transparent rounded-t-lg md:rounded-l-lg md:rounded-tr-none">
                <div id="modal-image-carousel" class="relative">
                    </div>
                <div id="modal-thumbnails" class="flex p-2 gap-2 justify-center bg-gray-900 md:bg-transparent">
                    </div>
            </div>

            <div class="w-full md:w-2/5 p-6 md:p-10 flex flex-col justify-between">
                <div>
                    <h3 id="modal-title" class="text-3xl font-light text-text-dark mb-2"></h3>
                    <p id="modal-subtitle" class="text-md text-text-muted mb-4 border-b border-border-light pb-4"></p>
                    
                    <div class="space-y-3 mb-6">
                        <p class="text-lg"><span class="font-semibold text-pantone-magenta">Serie:</span> <span id="modal-series"></span></p>
                        <p class="text-lg"><span class="font-semibold text-pantone-magenta">Medidas:</span> <span id="modal-dimensions"></span></p>
                    </div>

                    <p id="modal-description" class="text-base text-text-dark leading-relaxed mb-6"></p>
                    
                    <div id="price-section" class="pt-4 border-t border-border-light">
                        <div id="modal-price-display" class="hidden">
                            <p class="text-xl text-text-dark mb-2">Precio:</p>
                            <p id="modal-price" class="text-3xl font-bold text-pantone-magenta mb-4"></p>
                        </div>

                        <div id="modal-availability-box" class="p-3 rounded-sm text-center">
                            <p id="modal-availability" class="font-semibold"></p>
                        </div>
                    </div>
                </div>

                <div class="mt-8">
                    <button id="modal-contact-button" onclick="contactSeller()" class="bg-pantone-magenta hover:bg-opacity-80 text-white font-bold py-3 px-6 rounded-sm transition duration-300 w-full text-sm uppercase tracking-wider shadow-md">
                        Consultar por esta Obra
                    </button>
                    <button onclick="closeModal()" class="mt-3 text-sm text-text-muted hover:text-pantone-magenta transition duration-300 w-full">
                        Seguir explorando la galería
                    </button>
                </div>
            </div>
        </div>
    </div>


    <footer id="main-footer" class="fixed bottom-0 left-0 w-full bg-bg-card shadow-t-xl py-4 border-t border-border-light text-center transition-transform duration-500">
        <div class="max-w-7xl mx-auto px-6 flex flex-col sm:flex-row justify-between items-center text-sm text-text-muted">
            <p>&copy; 2024 Francisco Fernández. Todos los derechos reservados.</p>
            <div class="mt-2 sm:mt-0 space-x-4">
                <a href="#bio-section" class="hover:text-pantone-magenta transition">Biografía</a>
                <a href="./login.html" class="hover:text-pantone-magenta transition">Acceso Admin</a>
                <a href="mailto:francisco@tucorreo.com" class="hover:text-pantone-magenta transition">Contacto</a>
            </div>
        </div>
    </footer>


    <script src="config.js"></script>
    <script>
        // Inicialización de Supabase con las variables de config.js
        const supabaseUrl = window.supabaseUrl;
        const supabaseAnonKey = window.supabaseAnonKey;
        const client = supabase.createClient(supabaseUrl, supabaseAnonKey);

        // CONSTANTES GLOBALES
        const BUCKET_NAME = 'galeria-obras';
        const PAGE_SIZE = 8; // Número de obras a cargar inicialmente y por scroll
        
        // ESTADO GLOBAL
        let allWorks = []; // Almacena todas las obras
        let displayedWorks = []; // Obras filtradas y ordenadas
        let currentPage = 1; // Página actual para el lazy loading
        let currentFilters = {
            search: '',
            year: '',
            category: '',
            series: ''
        };


        // --- ELEMENTOS DEL DOM ---
        const galleryContainer = document.getElementById("gallery-container");
        const loadingOverlay = document.getElementById("loading-overlay");
        const obraModal = document.getElementById("obra-modal");
        const searchInput = document.getElementById("search-input");
        const filterYear = document.getElementById("filter-year");
        const filterCategory = document.getElementById("filter-category");
        const filterSeries = document.getElementById("filter-series");
        const loadMoreButton = document.getElementById("load-more-button");
        const loadMoreContainer = document.getElementById("load-more-container");
        const mainFooter = document.getElementById("main-footer");
        const whatsappButton = document.getElementById("whatsapp-button");


        // --- FUNCIONES DE GALERÍA Y DATOS ---

        // 1. Carga inicial de datos de Supabase
        async function fetchWorks() {
            // Cargar todas las obras ordenadas por posición y año (descendente)
            const { data, error } = await client
                .from('works')
                .select('*')
                .order('position', { ascending: true }) // Primero por posición
                .order('year', { ascending: false }); // Luego por año si la posición es la misma

            if (error) {
                console.error("Error al cargar obras:", error);
                loadingOverlay.classList.add('hidden');
                galleryContainer.innerHTML = '<p class="col-span-full text-center text-red-600">Error al cargar la galería. Intente nuevamente más tarde.</p>';
                return [];
            }
            return data;
        }

        // 2. Inicialización de la Galería
        async function initGallery() {
            allWorks = await fetchWorks();
            
            // Si no hay obras, mostramos un mensaje
            if (allWorks.length === 0) {
                loadingOverlay.classList.add('hidden');
                galleryContainer.innerHTML = '<p class="col-span-full text-center text-text-muted">Aún no hay obras publicadas en la galería.</p>';
                return;
            }

            // Llenar filtros
            populateFilters(allWorks);

            // Aplicar filtros iniciales y renderizar
            applyFilters();
            
            // Ocultar spinner
            loadingOverlay.classList.add('hidden');

            // Configurar Lazy Loading
            window.addEventListener('scroll', handleScroll);
            loadMoreButton.addEventListener('click', loadNextPage);
        }
        
        // 3. Llenar Selectores de Filtros (Año, Categoría, Serie)
        function populateFilters(works) {
            const years = new Set();
            const categories = new Set();
            const series = new Set();

            works.forEach(work => {
                years.add(work.year);
                if (work.category) categories.add(work.category);
                if (work.series) series.add(work.series);
            });

            // Llenar Años
            const sortedYears = Array.from(years).sort((a, b) => b - a);
            sortedYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                filterYear.appendChild(option);
            });

            // Llenar Categorías
            Array.from(categories).sort().forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                filterCategory.appendChild(option);
            });

            // Llenar Series
            Array.from(series).sort().forEach(ser => {
                const option = document.createElement('option');
                option.value = ser;
                option.textContent = ser;
                filterSeries.appendChild(option);
            });
        }

        // 4. Aplicar Filtros a las Obras
        function applyFilters() {
            // Actualizar el estado de los filtros
            currentFilters.search = searchInput.value.toLowerCase().trim();
            currentFilters.year = filterYear.value;
            currentFilters.category = filterCategory.value;
            currentFilters.series = filterSeries.value;

            // Filtrar el arreglo completo
            displayedWorks = allWorks.filter(obra => {
                const matchesSearch = currentFilters.search === '' ||
                    obra.title.toLowerCase().includes(currentFilters.search) ||
                    obra.technique.toLowerCase().includes(currentFilters.search) ||
                    (obra.description && obra.description.toLowerCase().includes(currentFilters.search));
                
                const matchesYear = currentFilters.year === '' || obra.year.toString() === currentFilters.year;
                const matchesCategory = currentFilters.category === '' || obra.category === currentFilters.category;
                const matchesSeries = currentFilters.series === '' || obra.series === currentFilters.series;

                return matchesSearch && matchesYear && matchesCategory && matchesSeries;
            });

            // Reiniciar la paginación y renderizar la primera página
            currentPage = 1;
            renderCurrentPage();
        }

        // 5. Renderizar la página actual de la Galería
        function renderCurrentPage() {
            const startIndex = 0;
            const endIndex = currentPage * PAGE_SIZE;
            const worksToRender = displayedWorks.slice(startIndex, endIndex);

            // Vaciar y renderizar
            galleryContainer.innerHTML = '';
            
            if (worksToRender.length === 0) {
                galleryContainer.innerHTML = '<p class="col-span-full text-center text-text-muted">No se encontraron obras que coincidan con los filtros.</p>';
            } else {
                renderWorks(worksToRender);
            }

            // Mostrar/Ocultar el botón Cargar Más
            if (worksToRender.length < displayedWorks.length) {
                loadMoreContainer.classList.remove('hidden');
            } else {
                loadMoreContainer.classList.add('hidden');
            }
        }

        // 6. Cargar la siguiente página
        function loadNextPage() {
            currentPage++;
            renderCurrentPage(); // Esto renderiza de nuevo todo el set, incluyendo la nueva página
        }

        // 7. Renderizar las tarjetas de obra (Mejorada la Vista Previa)
        function renderWorks(items) {
            galleryContainer.innerHTML = '';
            
            items.forEach(obra => {
                const card = document.createElement("div");
                // Clase de tarjeta mejorada: sombra más suave, efecto sutil de elevación.
                card.className = "bg-bg-card rounded-sm overflow-hidden cursor-pointer shadow-lg hover:shadow-xl transition duration-300 transform hover:translate-y-[-2px] group border border-border-light";
                card.setAttribute('data-id', obra.id); 
                card.setAttribute('onclick', `openModal(${obra.id})`);
                
                card.innerHTML = `
                    <div class="aspect-square overflow-hidden bg-gray-100"> 
                        <img src="${obra.mainImage}" alt="Obra de Francisco Fernández: ${obra.title}, ${obra.technique}" 
                             class="w-full h-full object-cover transition duration-500 group-hover:scale-105" 
                             onerror="this.onerror=null;this.src='[URL_IMAGEN_DEFAULT]';" />
                    </div>
                    <div class="p-4 border-t border-border-light">
                        <h3 class="text-lg font-medium text-text-dark truncate">${obra.title}</h3>
                        <p class="text-xs text-text-muted leading-tight">${obra.technique} · <span class="text-pantone-magenta font-semibold">${obra.year}</span></p>
                    </div>
                `;
                galleryContainer.appendChild(card);
            });
        }


        // --- MODAL Y DETALLE DE OBRA ---
        let currentObraId = null;

        function openModal(id) {
            currentObraId = id;
            const obra = allWorks.find(w => w.id === id);
            if (!obra) return;

            // Referencias del Modal
            const modalTitle = document.getElementById('modal-title');
            const modalSubtitle = document.getElementById('modal-subtitle');
            const modalSeries = document.getElementById('modal-series');
            const modalDimensions = document.getElementById('modal-dimensions');
            const modalDescription = document.getElementById('modal-description');
            const modalPriceDisplay = document.getElementById('modal-price-display');
            const modalPrice = document.getElementById('modal-price');
            const modalAvailabilityBox = document.getElementById('modal-availability-box');
            const modalAvailability = document.getElementById('modal-availability');
            const modalContactButton = document.getElementById('modal-contact-button');
            const modalCarousel = document.getElementById('modal-image-carousel');
            const modalThumbnails = document.getElementById('modal-thumbnails');

            // 1. Llenar Texto
            modalTitle.textContent = obra.title;
            modalSubtitle.textContent = `${obra.technique} · ${obra.category} · ${obra.year}`;
            modalSeries.textContent = obra.series || 'Sin serie';
            modalDimensions.textContent = obra.dimensions;
            modalDescription.textContent = obra.description || 'Sin descripción detallada.';

            // 2. Lógica de Precio y Disponibilidad
            if (obra.show_price && obra.price) {
                modalPrice.textContent = `$${obra.price.toLocaleString('es-AR')}`;
                modalPriceDisplay.classList.remove('hidden');
            } else {
                modalPriceDisplay.classList.add('hidden');
            }

            // Disponibilidad
            modalAvailabilityBox.className = 'p-3 rounded-sm text-center'; // Resetear clases
            if (obra.is_available) {
                modalAvailability.textContent = "Obra Disponible para Venta";
                modalAvailabilityBox.classList.add('bg-green-100', 'text-green-800');
                modalContactButton.textContent = "Consultar Precio y Adquisición";
            } else {
                modalAvailability.textContent = "Obra Vendida o Reservada";
                modalAvailabilityBox.classList.add('bg-red-100', 'text-red-800');
                modalContactButton.textContent = "Consultar por Obra Similar";
            }

            // Mostrar el botón de contacto siempre que no esté oculto
            modalContactButton.classList.remove('hidden');

            // 3. Carrusel de Imágenes
            const images = [obra.mainImage, ...obra.additionalImages.filter(img => img)].filter(Boolean);
            modalCarousel.innerHTML = '';
            modalThumbnails.innerHTML = '';
            let currentSlide = 0;

            images.forEach((url, index) => {
                const imgContainer = document.createElement('div');
                imgContainer.className = `carousel-slide absolute w-full h-full aspect-square transition-opacity duration-700 ease-in-out ${index === 0 ? 'opacity-100' : 'opacity-0'}`;
                imgContainer.innerHTML = `<img src="${url}" alt="Vista ${index + 1} de la obra ${obra.title}" 
                                            class="w-full h-full object-contain" style="max-height: 400px; max-height: 85vh; margin: auto;" 
                                            onload="checkImageDimensions(this, ${index === 0})">`;
                modalCarousel.appendChild(imgContainer);

                // Miniatura
                const thumbnail = document.createElement('img');
                thumbnail.src = url;
                thumbnail.className = `w-14 h-14 object-cover cursor-pointer rounded-sm border-2 transition-all duration-300 ${index === 0 ? 'border-pantone-magenta' : 'border-transparent opacity-70 hover:opacity-100'}`;
                thumbnail.onclick = () => showSlide(index);
                modalThumbnails.appendChild(thumbnail);
            });

            const slides = modalCarousel.querySelectorAll('.carousel-slide');
            const thumbnails = modalThumbnails.querySelectorAll('img');

            function showSlide(index) {
                currentSlide = index;
                slides.forEach((slide, i) => {
                    slide.classList.remove('opacity-100', 'z-10');
                    slide.classList.add('opacity-0');
                    if (i === index) {
                        slide.classList.add('opacity-100', 'z-10');
                    }
                });
                thumbnails.forEach((thumb, i) => {
                    thumb.classList.remove('border-pantone-magenta', 'opacity-100');
                    thumb.classList.add('border-transparent', 'opacity-70');
                    if (i === index) {
                        thumb.classList.add('border-pantone-magenta', 'opacity-100');
                        thumb.classList.remove('opacity-70');
                    }
                });
            }

            window.showSlide = showSlide; // Hacer accesible para onclick

            // 4. Mostrar Modal
            obraModal.classList.remove('hidden');
            obraModal.classList.add('flex');
            document.body.style.overflow = 'hidden'; // Evitar scroll de fondo
        }

        function closeModal() {
            obraModal.classList.add('hidden');
            obraModal.classList.remove('flex');
            document.body.style.overflow = '';
            currentObraId = null;
        }
        
        // Función para contacto directo por WhatsApp/Mail
        function contactSeller() {
            const obra = allWorks.find(w => w.id === currentObraId);
            if (!obra) return;

            const message = `Hola, estoy interesado en la obra *"${obra.title}"* (${obra.year}, ${obra.technique}). ¿Me podrías brindar más información sobre su precio y disponibilidad, por favor?`;
            // Reemplaza [TU_NUMERO_WHATSAPP_AQUI] con el número real
            const whatsappUrl = `https://wa.me/[TU_NUMERO_WHATSAPP_AQUI]?text=${encodeURIComponent(message)}`;

            window.open(whatsappUrl, '_blank');
        }

        window.openModal = openModal;
        window.closeModal = closeModal;
        window.contactSeller = contactSeller;
        
        // --- CARRUSEL DE FONDO ---
        let currentBgIndex = 0;
        const bgItems = document.querySelectorAll('#carousel-bg .carousel-item');
        
        function showNextBg() {
            bgItems[currentBgIndex].classList.remove('active');
            currentBgIndex = (currentBgIndex + 1) % bgItems.length;
            bgItems[currentBgIndex].classList.add('active');
        }

        // --- MANEJO DE SCROLL (Lazy Loading y Footer/WhatsApp) ---

        // Función para manejar el lazy loading al hacer scroll
        let isThrottled = false;
        function handleScroll() {
            if (isThrottled) return;

            isThrottled = true;
            setTimeout(() => {
                const scrollY = window.scrollY;
                const windowHeight = window.innerHeight;
                const bodyHeight = document.body.offsetHeight;
                
                // Lógica para cargar más al llegar al final (opcionalmente)
                if (scrollY + windowHeight >= bodyHeight - 500 && displayedWorks.length > currentPage * PAGE_SIZE) {
                    loadNextPage();
                }

                // Lógica de Footer y WhatsApp (Sticky)
                const firstSectionHeight = document.querySelector('section.min-h-screen').offsetHeight; 
                const gallerySectionTop = document.getElementById('gallery-section').offsetTop;

                // Mostrar/Ocultar Footer
                if (scrollY > firstSectionHeight - 100) { 
                    mainFooter.classList.remove('translate-y-full');
                } else {
                    mainFooter.classList.add('translate-y-full');
                }

                // Mostrar/Ocultar WhatsApp
                if (scrollY > gallerySectionTop / 2) { 
                    whatsappButton.classList.add('show');
                } else {
                    whatsappButton.classList.remove('show');
                }

                isThrottled = false;
            }, 200); // Throttling a 200ms
        }

        // --- INICIALIZACIÓN DE EVENTOS ---

        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar Carrusel de Fondo
            if(bgItems.length > 1) {
                setInterval(showNextBg, 6000); // Cambiar cada 6 segundos
            }
            
            // Inicializar Footer y WhatsApp como ocultos
            mainFooter.classList.add('translate-y-full');
            whatsappButton.classList.remove('show');
        });

        // Event Listeners de Filtro
        searchInput.addEventListener("input", applyFilters);
        filterYear.addEventListener("change", applyFilters);
        filterCategory.addEventListener("change", applyFilters);
        filterSeries.addEventListener("change", applyFilters);

        // Inicializar la Galería
        document.addEventListener('DOMContentLoaded', initGallery);

    </script>
</body>
</html>