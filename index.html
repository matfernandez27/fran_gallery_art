<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Francisco Fernández | Galería de Arte Patagónico, Dibujo y Grabado Contemporáneo</title>
    
    <meta name="description" content="Galería oficial de Francisco Fernández. Descubre obras de arte patagónico, grabados, dibujos y pintura que exploran la dualidad entre lo ancestral y lo moderno.">

    <meta property="og:title" content="Francisco Fernández - Arte Patagónico y Grabado Contemporáneo">
    <meta property="og:description" content="Descubre la Galería Personal de Francisco Fernández: un diálogo visual entre la inmensidad de la Patagonia y la experiencia urbana moderna.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://fran-faf.vercel.app/">
    <meta property="og:image" content="[URL_IMAGEN_DESTACADA]"> 
    <meta property="og:locale" content="es_AR">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configuración de colores personalizados (VIVO Y CLARO)
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pantone-magenta': '#DE3B89', // PANTONE 17-2036 TPG/TCX (Acento)
                        'bg-principal': '#FAEBF0',    // Fondo Principal (Magenta muy pálido)
                        'bg-card': '#FFFFFF',         // Fondo de Tarjetas/Secciones (Blanco puro)
                        'text-dark': '#333333',       // Texto principal (Gris oscuro)
                        'text-muted': '#666666',      // Texto secundario (Gris medio)
                        'border-light': '#E0E0E0',    // Bordes y líneas divisorias (Gris claro)
                        'whatsapp': '#25D366',        // Verde de WhatsApp
                        'facebook': '#1877F2',        // Azul de Facebook
                        'instagram': '#E4405F',       // Rojo de Instagram
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>

    <style>
        /* Estilos de Utilidad */
        #alert {
            position: fixed; top: 4px; left: 50%; transform: translateX(-50%);
            padding: 1rem; border-radius: 0.375rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 50;
            width: 90%; 
            max-width: 400px; 
            transition: opacity 0.3s ease-in-out;
        }
        .whatsapp-button {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            transform: translateY(150%);
            opacity: 0;
        }
        .whatsapp-button.show {
            transform: translateY(0);
            opacity: 1;
        }
        /* Estilo para el carrusel (ajustar si es necesario) */
        .carousel-item {
            display: none;
        }
        .carousel-item.active {
            display: block;
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-bg-principal text-text-dark font-sans min-h-screen">
    
    <div id="alert" class="hidden" role="alert"></div>
    
    <a href="https://wa.me/[TU_NUMERO_DE_WHATSAPP]?text=Hola%2C%20estoy%20interesado%2Fa%20en%20una%20obra." target="_blank"
        class="whatsapp-button fixed bottom-4 left-4 bg-whatsapp hover:bg-opacity-80 text-white font-bold py-2 px-4 rounded-full shadow-lg transition duration-300 z-50">
        WhatsApp
    </a>

    <header class="bg-bg-principal py-6 border-b border-border-light sticky top-0 z-40">
        <div class="max-w-6xl mx-auto px-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-pantone-magenta">
                <a href="#carousel-header">Francisco Fernández</a>
            </h1>
            <nav>
                <ul class="flex space-x-6 text-sm font-medium">
                    <li><a href="#gallery-section" class="text-text-dark hover:text-pantone-magenta transition duration-300">Galería</a></li>
                    <li><a href="./biografia-completa.html" class="text-text-dark hover:text-pantone-magenta transition duration-300">Biografía</a></li>
                    <li><a href="#contact-section" class="text-text-dark hover:text-pantone-magenta transition duration-300">Contacto</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="min-h-[calc(100vh-100px)]">

        <section id="carousel-header" class="bg-bg-principal pt-12 pb-20">
            <div class="max-w-6xl mx-auto px-4">
                <h2 class="text-center text-4xl font-extrabold text-text-dark mb-10">
                    Arte Patagónico Contemporáneo
                </h2>
                
                <div id="carousel-container" class="relative w-full overflow-hidden rounded-lg shadow-xl">
                    <div id="carousel-items" class="relative">
                        <div class="carousel-item active animate-pulse flex justify-center items-center bg-gray-200 h-[60vh]">
                            <p class="text-text-muted">Cargando obras...</p>
                        </div>
                    </div>

                    <button id="carousel-prev" class="absolute top-1/2 left-4 transform -translate-y-1/2 bg-white bg-opacity-50 p-3 rounded-full shadow-md hover:bg-opacity-80 transition duration-300 z-10 hidden">
                        <svg class="w-6 h-6 text-pantone-magenta" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button id="carousel-next" class="absolute top-1/2 right-4 transform -translate-y-1/2 bg-white bg-opacity-50 p-3 rounded-full shadow-md hover:bg-opacity-80 transition duration-300 z-10 hidden">
                        <svg class="w-6 h-6 text-pantone-magenta" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                    
                    <div id="carousel-indicators" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                        </div>
                </div>
            </div>
        </section>

        <section id="gallery-section" class="py-20 bg-bg-card">
            <div class="max-w-6xl mx-auto px-4">
                <h2 class="text-4xl font-extrabold text-text-dark mb-12 text-center">Catálogo de Obras</h2>
                
                <div class="mb-10 p-6 bg-bg-principal rounded-lg shadow-inner grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="text" id="search-input" placeholder="Buscar por título, técnica o descripción"
                        class="p-3 border border-border-light rounded-md focus:ring-pantone-magenta focus:border-pantone-magenta col-span-full md:col-span-1">
                    
                    <select id="filter-year" class="p-3 border border-border-light rounded-md focus:ring-pantone-magenta focus:border-pantone-magenta">
                        <option value="">Todos los Años</option>
                        </select>
                    
                    <select id="filter-category" class="p-3 border border-border-light rounded-md focus:ring-pantone-magenta focus:border-pantone-magenta">
                        <option value="">Todas las Categorías</option>
                        </select>

                    <select id="filter-series" class="p-3 border border-border-light rounded-md focus:ring-pantone-magenta focus:border-pantone-magenta">
                        <option value="">Todas las Series</option>
                        </select>
                </div>

                <div id="works-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div id="loading-placeholder" class="col-span-full text-center py-20 text-text-muted">
                        <p class="text-lg animate-pulse">Cargando obras...</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="contact-section" class="py-20 bg-bg-principal">
            <div class="max-w-3xl mx-auto px-4 text-center">
                <h2 class="text-4xl font-extrabold text-text-dark mb-6">Contacto y Consultas</h2>
                <p class="text-text-muted mb-10 text-lg">
                    Si está interesado en una obra, una colaboración, o simplemente desea saludar, por favor, envíe un mensaje a través de WhatsApp o correo electrónico.
                </p>

                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6">
                    <a href="https://wa.me/[TU_NUMERO_DE_WHATSAPP]?text=Hola%2C%20estoy%20interesado%2Fa%20en%20una%20obra." target="_blank"
                        class="bg-whatsapp hover:bg-opacity-80 text-white font-bold py-3 px-8 rounded-sm transition duration-300 uppercase tracking-wider shadow-lg">
                        Enviar un WhatsApp
                    </a>
                    <a href="mailto:[TU_CORREO_ELECTRONICO]"
                        class="bg-text-dark hover:bg-opacity-80 text-white font-bold py-3 px-8 rounded-sm transition duration-300 uppercase tracking-wider shadow-lg">
                        Enviar Email
                    </a>
                </div>

                <div class="mt-12 pt-6 border-t border-border-light">
                    <p class="text-sm text-text-muted mb-4">Sígueme en redes sociales:</p>
                    <div class="flex justify-center space-x-6">
                        <a href="[URL_INSTAGRAM]" target="_blank" class="text-instagram hover:opacity-80 transition duration-300">
                            <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.074 1.347.062 2.059.207 2.613.428a3.298 3.298 0 011.751 1.139 3.299 3.299 0 011.139 1.751c.221.554.366 1.266.428 2.613.063 1.266.074 1.646.074 4.85s-.012 3.584-.074 4.85c-.062 1.347-.207 2.059-.428 2.613a3.298 3.298 0 01-1.139 1.751 3.299 3.299 0 01-1.751 1.139c-.554.221-1.266.366-2.613.428-1.266.063-1.646.074-4.85.074s-3.584-.012-4.85-.074c-1.347-.062-2.059-.207-2.613-.428a3.298 3.298 0 01-1.751-1.139 3.299 3.299 0 01-1.139-1.751c-.221-.554-.366-1.266-.428-2.613-.063-1.266-.074-1.646-.074-4.85s.012-3.584.074-4.85c.062-1.347.207-2.059.428-2.613a3.298 3.298 0 011.139-1.751 3.299 3.299 0 011.751-1.139c.554-.221 1.266-.366 2.613-.428C8.416 2.175 8.796 2.163 12 2.163zm0 3.868c-3.321 0-6.007 2.686-6.007 6.007s2.686 6.007 6.007 6.007c3.321 0 6.007-2.686 6.007-6.007s-2.686-6.007-6.007-6.007zm0 9.875a3.868 3.868 0 110-7.736 3.868 3.868 0 010 7.736zm6.182-11.458a.965.965 0 11-1.93 0 .965.965 0 011.93 0z"/></svg>
                        </a>
                        <a href="[URL_FACEBOOK]" target="_blank" class="text-facebook hover:opacity-80 transition duration-300">
                            <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24"><path d="M22.675 0h-21.35c-.732 0-1.325.593-1.325 1.325v21.35c0 .732.593 1.325 1.325 1.325h11.493v-9.294h-3.13v-3.626h3.13v-2.19c0-3.111 1.894-4.821 4.673-4.821 1.325 0 2.464.099 2.8.143v3.25l-1.918.001c-1.503 0-1.802.715-1.802 1.768v2.31h3.64l-.473 3.626h-3.167v9.294h6.115c.732 0 1.325-.593 1.325-1.325v-21.35c0-.732-.593-1.325-1.325-1.325z"/></svg>
                        </a>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <a href="./admin.html" id="admin-link" class="fixed bottom-4 right-4 bg-pantone-magenta hover:bg-opacity-80 text-white font-bold py-2 px-4 rounded-full shadow-lg transition duration-300 z-50 hidden">
        Panel de Administración
    </a>

    <footer id="main-footer" class="fixed bottom-0 left-0 w-full bg-pantone-magenta text-white py-4 transition-transform duration-500 translate-y-full z-30">
        <div class="max-w-6xl mx-auto px-4 flex justify-between items-center text-sm">
            <p>&copy; 2024 Francisco Fernández. Todos los derechos reservados.</p>
            <a href="./login.html" class="hover:underline" id="login-link">Acceder</a>
        </div>
    </footer>

    <script>
        // Inicialización de Supabase
        const client = supabase.createClient(window.supabaseUrl, window.supabaseAnonKey);
        const TABLE_NAME = 'works';
        let allWorks = []; // Para almacenar todas las obras cargadas
        let currentWorks = []; // Para las obras actualmente filtradas
        
        // Elementos del DOM
        const worksGrid = document.getElementById('works-grid');
        const loadingPlaceholder = document.getElementById('loading-placeholder');
        const searchInput = document.getElementById('search-input');
        const filterYear = document.getElementById('filter-year');
        const filterCategory = document.getElementById('filter-category');
        const filterSeries = document.getElementById('filter-series');
        const mainFooter = document.getElementById('main-footer');
        const whatsappButton = document.querySelector('.whatsapp-button');
        const gallerySection = document.getElementById('gallery-section');
        const firstSection = document.getElementById('carousel-header'); 

        // --- FUNCIONES DE ALERTA Y UTILERÍA ---
        function showAlert(message, type = 'success') {
            const alertDiv = document.getElementById('alert');
            let bgColor, textColor;

            if (type === 'success') {
                bgColor = 'bg-green-100';
                textColor = 'text-green-700';
            } else if (type === 'error') {
                bgColor = 'bg-red-100';
                textColor = 'text-red-700';
            }

            alertDiv.className = `${bgColor} ${textColor} p-3 rounded-lg shadow-md transition duration-300 z-50`;
            alertDiv.textContent = message;
            alertDiv.classList.remove('hidden');

            setTimeout(() => {
                alertDiv.classList.add('hidden');
            }, 4000);
        }

        // --- FUNCIONES DE GALERÍA Y FILTROS ---

        function renderWorkCard(obra) {
            const imageUrl = obra.imagenes && obra.imagenes.length > 0 ? obra.imagenes[0].publicUrl : 'placeholder.jpg';
            const categoriesText = obra.categorias ? obra.categorias.join(', ') : '';

            return `
                <div class="bg-bg-card rounded-lg shadow-lg overflow-hidden transform hover:scale-[1.02] transition duration-500">
                    <img src="${imageUrl}" alt="${obra.titulo}" class="w-full h-72 object-cover">
                    <div class="p-6">
                        <h3 class="text-xl font-semibold text-text-dark mb-2">${obra.titulo}</h3>
                        <p class="text-pantone-magenta font-medium text-sm mb-2">${obra.anio}</p>
                        <p class="text-text-muted text-sm mb-4">${obra.tecnica}</p>
                        <p class="text-text-muted text-xs uppercase tracking-wider">${categoriesText}</p>
                    </div>
                </div>
            `;
        }

        function renderWorks(works) {
            worksGrid.innerHTML = ''; // Limpiar la cuadrícula
            loadingPlaceholder.classList.add('hidden');

            if (works.length === 0) {
                worksGrid.innerHTML = '<p class="col-span-full text-center py-10 text-text-muted">No se encontraron obras con los filtros seleccionados.</p>';
                return;
            }

            const worksHtml = works.map(renderWorkCard).join('');
            worksGrid.innerHTML = worksHtml;
        }

        function populateFilterOptions() {
            const years = new Set();
            const categories = new Set();
            const series = new Set();

            allWorks.forEach(obra => {
                years.add(obra.anio);
                if (obra.categorias) obra.categorias.forEach(cat => categories.add(cat));
                if (obra.serie) series.add(obra.serie);
            });

            // Llenar Año
            const sortedYears = Array.from(years).sort((a, b) => b - a);
            filterYear.innerHTML = '<option value="">Todos los Años</option>' + 
                sortedYears.map(year => `<option value="${year}">${year}</option>`).join('');

            // Llenar Categoría
            const sortedCategories = Array.from(categories).sort();
            filterCategory.innerHTML = '<option value="">Todas las Categorías</option>' + 
                sortedCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
                
            // Llenar Serie
            const sortedSeries = Array.from(series).sort();
            filterSeries.innerHTML = '<option value="">Todas las Series</option>' + 
                sortedSeries.map(s => `<option value="${s}">${s}</option>`).join('');
        }
        
        function applyFilters() {
            const searchText = searchInput.value.toLowerCase();
            const selectedYear = filterYear.value;
            const selectedCategory = filterCategory.value;
            const selectedSeries = filterSeries.value;

            const filtered = allWorks.filter(obra => {
                const titleMatch = obra.titulo.toLowerCase().includes(searchText);
                const techniqueMatch = obra.tecnica.toLowerCase().includes(searchText);
                const descriptionMatch = obra.descripcion.toLowerCase().includes(searchText);
                
                const yearMatch = !selectedYear || obra.anio.toString() === selectedYear;
                
                const categoryMatch = !selectedCategory || (obra.categorias && obra.categorias.includes(selectedCategory));
                
                const seriesMatch = !selectedSeries || obra.serie === selectedSeries;

                return (titleMatch || techniqueMatch || descriptionMatch) && yearMatch && categoryMatch && seriesMatch;
            });

            currentWorks = filtered;
            renderWorks(currentWorks);
        }

        async function loadWorks() {
            loadingPlaceholder.classList.remove('hidden');
            try {
                const { data, error } = await client
                    .from(TABLE_NAME)
                    .select('id, titulo, anio, tecnica, descripcion, categorias, serie, destacado, position, imagenes') // Incluir 'position'
                    .order('position', { ascending: true }); // Ordenar por la posición

                if (error) throw error;

                allWorks = data;
                currentWorks = [...allWorks]; // Inicialmente, todas las obras son las obras actuales
                
                populateFilterOptions();
                renderWorks(currentWorks);
                initCarousel(); // Inicializar el carrusel con los datos
                
            } catch (error) {
                console.error("Error al cargar las obras:", error);
                showAlert("Error al cargar la galería. Intente recargar la página.", 'error');
            } finally {
                loadingPlaceholder.classList.add('hidden');
            }
        }
        
        // --- FUNCIONES DEL CARRUSEL ---
        
        let carouselWorks = [];
        let currentSlide = 0;
        
        function initCarousel() {
            // Filtrar solo las obras destacadas
            carouselWorks = allWorks.filter(obra => obra.destacado).sort((a, b) => a.position - b.position);

            if (carouselWorks.length === 0) {
                document.getElementById('carousel-container').classList.add('hidden');
                return;
            }

            renderCarouselItems();
            
            document.getElementById('carousel-prev').classList.remove('hidden');
            document.getElementById('carousel-next').classList.remove('hidden');

            document.getElementById('carousel-prev').addEventListener('click', () => changeSlide(-1));
            document.getElementById('carousel-next').addEventListener('click', () => changeSlide(1));
            
            // Auto-avance (opcional)
            setInterval(() => changeSlide(1), 5000); 
        }

        function renderCarouselItems() {
            const container = document.getElementById('carousel-items');
            const indicatorsContainer = document.getElementById('carousel-indicators');
            container.innerHTML = '';
            indicatorsContainer.innerHTML = '';

            carouselWorks.forEach((obra, index) => {
                const imageUrl = obra.imagenes && obra.imagenes.length > 0 ? obra.imagenes[0].publicUrl : 'placeholder.jpg';
                
                // Item de Carrusel
                const item = document.createElement('div');
                item.className = `carousel-item relative ${index === currentSlide ? 'active animate-fadeIn' : ''}`;
                item.innerHTML = `
                    <img src="${imageUrl}" alt="${obra.titulo}" class="w-full h-[60vh] object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex flex-col justify-end p-8">
                        <h3 class="text-3xl font-bold text-white mb-2">${obra.titulo}</h3>
                        <p class="text-white text-lg">${obra.tecnica} | ${obra.anio}</p>
                    </div>
                `;
                container.appendChild(item);

                // Indicador (Dot)
                const indicator = document.createElement('button');
                indicator.className = `w-3 h-3 rounded-full transition duration-300 ${index === currentSlide ? 'bg-pantone-magenta' : 'bg-white bg-opacity-50'}`;
                indicator.addEventListener('click', () => goToSlide(index));
                indicatorsContainer.appendChild(indicator);
            });
        }
        
        function changeSlide(direction) {
            let newSlide = currentSlide + direction;
            if (newSlide < 0) {
                newSlide = carouselWorks.length - 1;
            } else if (newSlide >= carouselWorks.length) {
                newSlide = 0;
            }
            goToSlide(newSlide);
        }

        function goToSlide(index) {
            const items = document.querySelectorAll('#carousel-items .carousel-item');
            const indicators = document.querySelectorAll('#carousel-indicators button');

            // Quitar animación y clase active
            items[currentSlide].classList.remove('active', 'animate-fadeIn');
            indicators[currentSlide].className = 'w-3 h-3 rounded-full transition duration-300 bg-white bg-opacity-50';

            currentSlide = index;
            
            // Poner animación y clase active
            items[currentSlide].classList.add('active', 'animate-fadeIn');
            indicators[currentSlide].className = 'w-3 h-3 rounded-full transition duration-300 bg-pantone-magenta';
        }

        // --- GESTIÓN DE AUTENTICACIÓN (ADMIN) ---

        async function checkAdminStatus() {
            const { data: { session } } = await client.auth.getSession();
            const loginLink = document.getElementById('login-link');
            const adminLink = document.getElementById('admin-link'); // NUEVA LÍNEA

            if (session) {
                // Si hay sesión, es administrador. Ocultamos el 'Acceder' y mostramos el 'Panel Admin' flotante.
                if (loginLink) loginLink.classList.add('hidden');
                if (adminLink) adminLink.classList.remove('hidden'); 
            } else {
                // Si no hay sesión, mostramos el 'Acceder' y ocultamos el 'Panel Admin' flotante.
                if (loginLink) loginLink.classList.remove('hidden');
                if (adminLink) adminLink.classList.add('hidden'); 
            }
        }

        // --- INICIALIZACIÓN Y EVENTOS ---
        
        window.addEventListener('scroll', () => {
            if (!firstSection) return;
            
            const firstSectionHeight = firstSection.offsetHeight;
            
            // Lógica del Footer
            if (window.scrollY > firstSectionHeight - 100) { 
                mainFooter.classList.remove('translate-y-full');
            } else {
                mainFooter.classList.add('translate-y-full');
            }

            // Lógica del Botón de WhatsApp
            const gallerySectionTop = gallerySection ? gallerySection.offsetTop : firstSectionHeight;
            if (window.scrollY > gallerySectionTop - window.innerHeight / 2) { 
                whatsappButton.classList.add('show');
            } else {
                whatsappButton.classList.remove('show');
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Ocultar elementos al cargar para una transición suave
            mainFooter.classList.add('translate-y-full');
            whatsappButton.classList.remove('show');
            
            // Cargar datos
            loadWorks(); 
            
            // Verificar sesión de administrador
            checkAdminStatus();
        });

        // Event Listeners de Filtro
        searchInput.addEventListener("input", applyFilters);
        filterYear.addEventListener("change", applyFilters);
        filterCategory.addEventListener("change", applyFilters);
        filterSeries.addEventListener("change", applyFilters);

    </script>
</body>
</html>