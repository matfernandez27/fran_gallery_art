<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Francisco Fernández | Galería de Arte Patagónico, Dibujo y Grabado Contemporáneo</title>
    
    <meta name="description" content="Galería oficial de Francisco Fernández. Descubre obras de arte patagónico, grabados, dibujos y pintura que exploran la dualidad entre lo ancestral y lo moderno.">

    <meta property="og:title" content="Francisco Fernández - Arte Patagónico y Grabado Contemporáneo">
    <meta property="og:description" content="Descubre la Galería Personal de Francisco Fernández: un diálogo visual entre la inmensidad de la Patagonia y la experiencia urbana moderna.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://fran-faf.vercel.app/">
    <meta property="og:image" content="[URL_IMAGEN_DESTACADA]"> 
    <meta property="og:locale" content="es_AR">
    <link rel="icon" type="image/png" href="./img/favicon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configuración de colores personalizados (VIVO Y CLARO)
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pantone-magenta': '#DE3B89', // PANTONE 17-2036 TPG/TCX (Color central)
                        'bg-principal': '#FAEBF0',    // Fondo suave, casi blanco rosado
                        'bg-card': '#FFFFFF',         // Blanco para tarjetas
                        'text-dark': '#333333',       // Texto principal oscuro
                        'text-muted': '#666666',      // Texto secundario/descripciones
                        'border-light': '#E0E0E0',    // Borde de divisores
                        'whatsapp': '#25D366',        // Color oficial de WhatsApp
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>

    <style>
        /* Estilos específicos para el botón de WhatsApp (REESTABLECIDOS) */
        #whatsapp-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            transition: all 0.3s ease-in-out;
            transform: scale(0); /* Inicialmente oculto */
            opacity: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        #whatsapp-button.show {
            transform: scale(1);
            opacity: 1;
        }
        
        /* Estilos para el Footer (REESTABLECIDOS) */
        #main-footer {
            transition: transform 0.5s ease-out;
        }

        /* Estilos de la galería */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        /* Animación de carga */
        @keyframes pulse-bg {
            0%, 100% { background-color: #f3f4f6; }
            50% { background-color: #e5e7eb; }
        }
        .loading-card {
            height: 350px;
            animation: pulse-bg 1.5s infinite;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-bg-principal text-text-dark font-sans min-h-screen">

    <header class="bg-bg-principal py-6 shadow-sm sticky top-0 z-40 border-b border-border-light">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <a href="./index.html" class="text-3xl font-bold text-pantone-magenta tracking-tight">
                F.F.
            </a>
            <nav class="space-x-8 hidden sm:block">
                <a href="#gallery-section" class="text-text-dark hover:text-pantone-magenta font-medium transition duration-300">Galería</a>
                <a href="./biografia-completa.html" class="text-text-dark hover:text-pantone-magenta font-medium transition duration-300">Biografía</a>
                <a href="mailto:contacto@ffernandez.com" class="text-text-dark hover:text-pantone-magenta font-medium transition duration-300">Contacto</a>
            </nav>
            <button class="sm:hidden text-text-dark hover:text-pantone-magenta">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
            </button>
        </div>
    </header>

    <section id="hero-section" class="relative pt-16 pb-24 bg-white/70">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-6xl md:text-8xl font-extrabold text-pantone-magenta leading-none mb-4">
                Francisco Fernández
            </h1>
            <p class="text-xl md:text-2xl text-text-dark mb-10 max-w-3xl mx-auto">
                Arte Patagónico | Grabado Contemporáneo
            </p>
            <a href="#gallery-section" class="bg-pantone-magenta hover:bg-opacity-80 text-white font-bold py-3 px-8 rounded-sm transition duration-300 text-sm uppercase tracking-wider shadow-lg">
                Explorar Obras
            </a>
        </div>
    </section>

    <section id="gallery-section" class="py-20 bg-bg-principal">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-4xl font-bold text-text-dark mb-12 border-b-4 border-pantone-magenta inline-block pb-1">
                Galería
            </h2>
            
            <div class="mb-10 p-4 bg-bg-card rounded-lg shadow-sm flex flex-wrap items-center space-y-4 md:space-y-0 md:space-x-6">
                <div class="flex-grow w-full md:w-auto">
                    <label for="search" class="sr-only">Buscar por título, técnica o descripción</label>
                    <input type="text" id="search" placeholder="Buscar por título o técnica..." class="w-full border-2 border-border-light rounded-sm p-2 focus:border-pantone-magenta focus:ring-pantone-magenta transition duration-300">
                </div>
                <div>
                    <label for="filter-year" class="text-sm text-text-muted mr-2">Año:</label>
                    <select id="filter-year" class="border-2 border-border-light rounded-sm p-2 bg-white focus:border-pantone-magenta transition duration-300">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div id="admin-link-container" class="ml-auto text-sm">
                    </div>
            </div>

            <div id="gallery-grid" class="gallery-grid">
                <div class="loading-card"></div>
                <div class="loading-card hidden md:block"></div>
                <div class="loading-card hidden lg:block"></div>
            </div>
            
            <div id="no-results" class="text-center py-10 hidden">
                <p class="text-xl text-text-muted">No se encontraron obras que coincidan con los filtros aplicados.</p>
            </div>
        </div>
    </section>
    
    <a id="whatsapp-button" href="https://wa.me/XXXXXXXXXXX" target="_blank" class="bg-whatsapp text-white rounded-full p-4 hover:bg-green-600 transition duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12c0 3.189 1.353 6.07 3.513 8.046L4 22l2.067-.53c.895.498 1.897.777 2.933.777C13.523 22 18 17.523 18 12S13.523 2 12 2zm3.385 14.896c-.198-.103-.795-.401-.916-.479-.121-.078-.26-.117-.373.117s-.471.479-.574.597c-.103.117-.206.117-.384.078-.962-.321-1.789-.887-2.482-1.637-.693-.75-1.15-1.651-1.282-2.584-.04-.123-.004-.2-.043-.242-.038-.04-.373-.079-.486-.103-.113-.024-.26-.062-.384-.062s-.223.039-.344.195c-.121.156-.467.452-.467 1.1c0 .647.477 1.258.54 1.346.062.088.948 1.488 2.296 2.046 1.348.558 1.348.371 1.6 1.058.252.687.252 1.272.189 1.389-.062.117-.216.156-.412.039-1.896-.78-2.673-1.652-2.887-1.936-.214-.284-.428-.58-.428-.902 0-.323.238-.49.33-.585.093-.096.206-.242.308-.36.103-.117.206-.175.308-.234.103-.058.206-.058.308.039.103.097.649 1.579 2.053 2.193 1.404.614 2.152.479 2.508.432.356-.048.795-.316.916-.672.121-.356.121-.661.082-.739-.039-.078-.152-.103-.311-.181z"/></svg>
    </a>

    <footer id="main-footer" class="fixed bottom-0 left-0 right-0 bg-pantone-magenta/95 backdrop-blur-sm text-white transform translate-y-full z-30 shadow-2xl">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm">
            <p>&copy; 2024 Francisco Fernández. Todos los derechos reservados.</p>
            <p class="text-xs mt-1 opacity-80">Hecho con ❤️ en Patagonia. | <a href="./admin.html" class="underline hover:opacity-100 transition duration-300" id="admin-auth-text">Admin Login</a></p>
        </div>
    </footer>

    <div id="obra-detail-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 items-center justify-center p-4" onclick="closeDetailModal()">
        <div class="bg-bg-card rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div id="modal-content" class="p-6">
                </div>
            <button onclick="closeDetailModal()" class="absolute top-3 right-3 text-text-dark hover:text-pantone-magenta bg-white rounded-full p-2 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
    </div>


    <script>
        /* global supabase, window */ 
        
        // --- CONFIGURACIÓN DE SUPABASE ---
        const supabaseUrl = window.supabaseUrl;
        const supabaseAnonKey = window.supabaseAnonKey;
        const client = supabase.createClient(supabaseUrl, supabaseAnonKey);
        
        const TABLE_NAME = 'productos'; 
        const BUCKET_NAME = 'imagenes';
        
        let allWorks = []; // Almacena todas las obras
        let filteredWorks = []; // Obras después de aplicar filtros

        // --- REFERENCIAS DOM ---
        const galleryGrid = document.getElementById('gallery-grid');
        const noResults = document.getElementById('no-results');
        const mainFooter = document.getElementById('main-footer');
        const whatsappButton = document.getElementById('whatsapp-button');
        const searchInput = document.getElementById('search');
        const filterYear = document.getElementById('filter-year');
        const obraDetailModal = document.getElementById('obra-detail-modal');
        const modalContent = document.getElementById('modal-content');
        const adminLinkContainer = document.getElementById('admin-link-container');
        
        // --- UTILIDADES ---

        function getPublicUrl(path) {
            if (!path) return './img/placeholder.jpg';
            const { data } = client.storage.from(BUCKET_NAME).getPublicUrl(path);
            return data.publicUrl;
        }

        // --- LÓGICA DE GALERÍA Y FILTROS ---

        async function loadWorks() {
            try {
                // Se obtiene sólo los campos necesarios
                const { data, error } = await client
                    .from(TABLE_NAME) 
                    .select("id, titulo, tecnica, anio, is_available, imagen_principal, descripcion, dimensiones")
                    .order("orden", { ascending: true }) // Ordenamiento por el campo 'orden'
                    .order("anio", { ascending: false }); // Segundo orden por año

                if (error) throw error;
                
                allWorks = data;
                populateYearFilters(data);
                applyFilters();

            } catch (error) {
                console.error("Error al cargar las obras:", error);
                galleryGrid.innerHTML = '<p class="text-center text-red-600 col-span-full">Error al cargar las obras. Por favor, intente de nuevo más tarde.</p>';
            }
        }
        
        function populateYearFilters(works) {
            const years = [...new Set(works.map(w => w.anio).filter(Boolean))].sort((a, b) => b - a);
            filterYear.innerHTML = '<option value="">Todos</option>';
            years.forEach(year => {
                filterYear.innerHTML += `<option value="${year}">${year}</option>`;
            });
        }

        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const selectedYear = filterYear.value;

            filteredWorks = allWorks.filter(obra => {
                const matchesSearch = 
                    obra.titulo.toLowerCase().includes(searchTerm) ||
                    (obra.tecnica && obra.tecnica.toLowerCase().includes(searchTerm)) ||
                    (obra.descripcion && obra.descripcion.toLowerCase().includes(searchTerm));

                const matchesYear = selectedYear === '' || obra.anio == selectedYear;
                
                // Mostrar solo las obras disponibles
                const isAvailable = obra.is_available; 

                return matchesSearch && matchesYear && isAvailable;
            });

            renderGallery(filteredWorks);
        }

        function renderGallery(works) {
            galleryGrid.innerHTML = ''; // Limpiar el grid

            if (works.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }

            noResults.classList.add('hidden');

            works.forEach(obra => {
                const imageUrl = getPublicUrl(obra.imagen_principal);
                
                galleryGrid.innerHTML += `
                    <div class="bg-bg-card rounded-lg shadow-lg overflow-hidden transform hover:shadow-xl hover:scale-[1.01] transition duration-300 cursor-pointer" onclick="openDetailModal('${obra.id}')">
                        <img src="${imageUrl}" alt="${obra.titulo}" class="w-full h-80 object-cover" onerror="this.onerror=null;this.src='./img/placeholder.jpg';">
                        <div class="p-4">
                            <h3 class="text-xl font-semibold text-text-dark">${obra.titulo}</h3>
                            <p class="text-text-muted mt-1">${obra.tecnica} (${obra.anio})</p>
                        </div>
                    </div>
                `;
            });
        }
        
        // --- LÓGICA DEL MODAL DE DETALLES ---

        function openDetailModal(id) {
            const obra = allWorks.find(w => w.id === id);
            if (!obra) return;

            const imageUrl = getPublicUrl(obra.imagen_principal);

            modalContent.innerHTML = `
                <div class="md:flex">
                    <div class="md:w-1/2 p-2">
                        <img src="${imageUrl}" alt="${obra.titulo}" class="w-full h-auto object-contain rounded-md shadow-lg" onerror="this.onerror=null;this.src='./img/placeholder.jpg';">
                    </div>
                    <div class="md:w-1/2 md:p-6 p-2 pt-4">
                        <h3 class="text-3xl font-bold text-pantone-magenta mb-2">${obra.titulo}</h3>
                        <p class="text-xl text-text-dark mb-4">${obra.tecnica} | ${obra.anio}</p>
                        
                        <div class="space-y-3 mb-6">
                            <p class="text-text-muted"><span class="font-semibold text-text-dark">Dimensiones:</span> ${obra.dimensiones || 'N/A'}</p>
                            <p class="text-text-muted"><span class="font-semibold text-text-dark">Estado:</span> <span class="text-green-600 font-semibold">${obra.is_available ? 'Disponible' : 'Vendido'}</span></p>
                        </div>
                        
                        <p class="text-text-dark leading-relaxed mb-6">
                            ${obra.descripcion || 'Sin descripción detallada.'}
                        </p>
                        
                        <a href="https://wa.me/XXXXXXXXXXX?text=Hola%2C%20estoy%20interesado%20en%20la%20obra%20%22${encodeURIComponent(obra.titulo)}%22." target="_blank" class="bg-whatsapp hover:bg-green-600 text-white font-bold py-3 px-6 rounded-sm transition duration-300 flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12c0 3.189 1.353 6.07 3.513 8.046L4 22l2.067-.53c.895.498 1.897.777 2.933.777C13.523 22 18 17.523 18 12S13.523 2 12 2zm3.385 14.896c-.198-.103-.795-.401-.916-.479-.121-.078-.26-.117-.373.117s-.471.479-.574.597c-.103.117-.206.117-.384.078-.962-.321-1.789-.887-2.482-1.637-.693-.75-1.15-1.651-1.282-2.584-.04-.123-.004-.2-.043-.242-.038-.04-.373-.079-.486-.103-.113-.024-.26-.062-.384-.062s-.223.039-.344.195c-.121.156-.467.452-.467 1.1c0 .647.477 1.258.54 1.346.062.088.948 1.488 2.296 2.046 1.348.558 1.348.371 1.6 1.058.252.687.252 1.272.189 1.389-.062.117-.216.156-.412.039-1.896-.78-2.673-1.652-2.887-1.936-.214-.284-.428-.58-.428-.902 0-.323.238-.49.33-.585.093-.096.206-.242.308-.36.103-.117.206-.175.308-.234.103-.058.206-.058.308.039.103.097.649 1.579 2.053 2.193 1.404.614 2.152.479 2.508.432.356-.048.795-.316.916-.672.121-.356.121-.661.082-.739-.039-.078-.152-.103-.311-.181z"/></svg>
                            <span>Consultar Disponibilidad</span>
                        </a>
                    </div>
                </div>
            `;

            obraDetailModal.classList.remove('hidden');
            obraDetailModal.classList.add('flex');
            document.body.style.overflow = 'hidden'; // Evitar scroll de fondo
        }

        function closeDetailModal() {
            obraDetailModal.classList.add('hidden');
            obraDetailModal.classList.remove('flex');
            document.body.style.overflow = '';
        }
        
        // --- GESTIÓN DE AUTENTICACIÓN ADMIN ---

        async function checkAdminStatus() {
            const { data: { user } } = await client.auth.getUser();
            const adminText = document.getElementById('admin-auth-text');
            
            if (user) {
                adminLinkContainer.innerHTML = `<span class="text-sm text-green-600">Admin Logueado</span> | <a href="./admin.html" class="text-pantone-magenta hover:underline font-semibold">Ir a Panel</a>`;
                adminText.textContent = 'Panel Admin';
            } else {
                adminLinkContainer.innerHTML = ''; // Se mantiene solo el enlace del footer
                adminText.textContent = 'Admin Login';
            }
        }
        
        // --- CONTROL DE SCROLL (Footer y WhatsApp) ---

        const heroSection = document.getElementById('hero-section');
        const gallerySection = document.getElementById('gallery-section');

        window.addEventListener('scroll', () => {
            if (!heroSection) return;
            
            const heroSectionHeight = heroSection.offsetHeight;
            
            // Lógica del Footer
            if (window.scrollY > heroSectionHeight - 100) { 
                mainFooter.classList.remove('translate-y-full');
            } else {
                mainFooter.classList.add('translate-y-full');
            }

            // Lógica del Botón de WhatsApp
            const gallerySectionTop = gallerySection ? gallerySection.offsetTop : heroSectionHeight;
            if (window.scrollY > gallerySectionTop - window.innerHeight / 2) { 
                whatsappButton.classList.add('show');
            } else {
                whatsappButton.classList.remove('show');
            }
        });

        // --- FUNCIONES ACCESIBLES GLOBALMENTE ---
        window.openDetailModal = openDetailModal;
        window.closeDetailModal = closeDetailModal;


        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            // Ocultar elementos al cargar para una transición suave
            mainFooter.classList.add('translate-y-full');
            whatsappButton.classList.remove('show');
            
            // Cargar datos
            loadWorks(); 
            
            // Verificar sesión de administrador
            checkAdminStatus();
        });

        // Event Listeners de Filtro
        searchInput.addEventListener("input", applyFilters);
        filterYear.addEventListener("change", applyFilters);

    </script>
</body>
</html>